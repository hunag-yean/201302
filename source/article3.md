## 三角網格化 --以Z-Scan演算法為例 (作者：吳栢融)

三角網格化（Triangulation）是電腦圖學（Computer Graphics）中有關建模技術（Modeling）的一個關鍵課題，我們都知道模型檔案最基本的由點和面構成。而對於一個面所構成的點我們並無嚴格規範，換言之，三角形，矩形都是一個面。如此一來再檔案的存取上造成許多麻煩的問題，如必須動態配置每一個面到底有多少索引、規劃每個面採何種方式來絢爛（Rending）。另外非常多的圖學演算法只作用與三角網格化後的多邊形網格，故通常我們會將模型轉換成三角形網格後發布、或做其他演算。

三角網格化有非常多方法，筆者就不再一一細說，本文以Z-Scan的方式來討論如何將模型三角化。有關Z-Scan的方法提出筆者目前尚未得知為何人。如有讀者知道還請[來信][wupojung@mail]告知。感謝!!

###基礎理論
我們都知道一個模型由點和面構成，但對於三角網格而言，他們是否存在一定的關係呢？事實上，我們可以透過歸納法來驗證下述公式。

`F=V-2`

其中V為構成該mesh的點的個數，F為若將該mesh三角網格化以後會得到的面的數量。我們可以參考下圖驗證之。

![圖1:面與點的關係圖][面與點的關係圖]

此外，通常在OpenGL的環境中我們為了統一`normal`我們預設mesh的index是依照逆時針的方式記錄。如下圖所示，由於我們統一規範mesh的排序方式，所以我們可以藉由數學公式計算出mesh的normal，而這個normal的功能，筆者就不再這說明了。

![圖2:逆時針送點示意圖][逆時針送點示意圖]


###程式分析

為了取得一個最簡單的算法，筆者使用了歸納法來解這個問題，筆者假設圖3為圖2三角化的結果，而該多多邊形共計7個頂點（V=7），估根據上述公式我們可以得到三角化後應該產生5個三角形面（F=V-2=5），筆者將其標記為F0-F4，如圖3所示。並將每個三角形對應的三角形歸納入表1所示。

![圖3:分割圖][分析]

![表1:三角化後的每個三角形的對應索引][表格]

從上表我們可以得到如下關係:

- Index[0] 的次序為 0665544332....不斷遞減
- Index[1] 的次序為 1122334455....不斷遞增
- Index[2] 的次序為 62534... 分成奇偶分別遞增遞減

於是我們做以下測試:

```CPP
    int V=7;
    int F=V-2;
```
    
針對Index[0]有:
    
```CPP
    for(int i=0;i<F;i++){
    	if(i==0)
        	cout<<i<<"="<<0<<endl;
        else
            cout<<i<<"="<<V-(i+1)/2<<endl;
    }
```
            
針對Index[1]有:
    
```CPP
	for(int i=0;i<F;i++){  
		cout<<i<<"="<<(i+2)/2<<endl;
	}
```

針對Index[2]有:            
 
```CPP
	for(int i=0;i<F;i++){  
		if(i%2==0)
			cout<<i<<"="<<V-(i+2)/2<<endl;
		else
			cout<<i<<"="<<(i+3)/2<<endl;
	}
```

根據上述的分開測試。我們可以將所有程式合併在一起，如下所示：

###完整代碼

```CPP
    for(int i=0;i<F;i++)
    { 
            if(i==0){
                 cout<<i<<"="<<0<<"\t"<<i+1<<"\t"<<V-1<<endl;
            }else{
                  if(i%2==0)
                     cout<<i<<"="<<V-(i+1)/2<<"\t"<<(i+2)/2<<"\t"<<V-(i+2)/2<<endl;
                  else
                    cout<<i<<"="<<V-(i+1)/2<<"\t"<<(i+2)/2<<"\t"<<(i+3)/2<<endl;                 
            }
       
    }
```

###後記
其實三角網格化還有非常多的方式可以完成，筆者本篇僅拋磚引玉，希望大家可以分享新的方法。


[面與點的關係圖]:../img/20121121131157krcp4.jpg

[分析]:../img/20121121140350n3xny.jpg
[表格]:../img/20121121140418kgtp4.jpg
[逆時針送點示意圖]:../img/20121121133615xdbms.jpg

[wupojung@mail]:wupojung@gmail.com

